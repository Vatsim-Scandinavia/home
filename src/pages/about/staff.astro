---
const SiteTitle = "Staff";
import Layout from "../../layout/Layout.astro";
import StaffCard from "../../components/StaffCard.astro";
import staffData from "../../data/staff-positions.json";

// Helper function to check if member is in a section
function isInSection(member: any, sectionName: string): boolean {
    return member.section && member.section.includes(sectionName);
}

// Get vACC Director
const director = staffData.staff.find(
    (member) => isInSection(member, "vacc_director")
);

// Get FIR directors
const firDirectors = staffData.staff.filter(
    (member) =>
        isInSection(member, "fir_director")
);

// Get tech team
const techTeam = staffData.staff.filter(
    (member) => 
        isInSection(member, "tech")
);

// Get event team (event sections, but not board members)
const eventTeam = staffData.staff.filter(
    (member) =>
        isInSection(member, "event")
);

// Get Training Team
const trainingTeam = staffData.staff.filter(
  (member) =>
    isInSection(member, "training") &&
    !isInSection(member, "board")
);

// Get country staff (includes country directors, training, and event staff)
// Exclude vACC Director, board-only members & tech team
const countryStaff = staffData.staff.filter(
    (member) => {
        // Exclude vACC Director
        if (member.title === "vACC Director") return false;
        
        // Exclude tech team
        if (isInSection(member, "technical") || isInSection(member, "dpo")) return false;
        
        // Exclude navdata
        if (isInSection(member, "navdata")) return false;
        
        // Exclude board-only members (not country directors)
        if (isInSection(member, "board") && !member.title.includes("Director of")) return false;
        
        // Include country directors, training, and event staff
        return member.title.includes("Director of") || 
               isInSection(member, "training") ||
               isInSection(member, "event");
    }
);

// Sort function for country staff
function getTitleSortOrder(title: string): number {
    // "Director of" (not Assistant Director) should be first
    if (title.startsWith("Director of") && !title.includes("Assistant")) return 1;
    // Assistant Director comes after main Director
    if (title.includes("Assistant Director")) return 2;
    if (title.includes("Training Manager")) return 3;
    if (title.includes("Training Assistant")) return 4;
    if (title.includes("Event")) return 5;
    return 6;
}

// Country order for display
const countryOrder = ["DK", "NO", "SE", "FI", "IS"];
const countryNames: { [key: string]: string } = {
    "DK": "Denmark",
    "NO": "Norway",
    "SE": "Sweden",
    "FI": "Finland",
    "IS": "Iceland"
};
---

<Layout SiteTitle={`${SiteTitle} | VATSIM Scandinavia`}>
    <div class="w-full p-6">
        <h1 class="text-4xl font-bold mb-2 text-gray-900 dark:text-white">Staff</h1>
        <p class="text-gray-600 dark:text-gray-400 mb-8">
            Meet the dedicated individuals who make VATSIM Scandinavia a great community.
        </p>

        {/* Director Section */}
        {director && (
            <div class="mb-12">
                <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white text-center sm:text-left">vACC Director</h2>
                <div class="flex flex-wrap gap-6 justify-center sm:justify-start">
                    <StaffCard member={director} />
                </div>
            </div>
        )}

        {/* Board Members Section */}
        {firDirectors.length > 0 && (
            <div class="mb-12">
                <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white text-center sm:text-left">FIR Directors</h2>
                <div class="flex flex-wrap gap-6 justify-center sm:justify-start">
                    {firDirectors.map((member) => (
                        <StaffCard member={member} />
                    ))}
                </div>
            </div>
        )}

      {/* FIR Directors */}
      {trainingTeam.length > 0 && (
        <div class="mb-12">
          <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white text-center sm:text-left">Training Team</h2>
          <div class="flex flex-wrap gap-6 justify-center sm:justify-start">
            {trainingTeam.map((member) => (
              <StaffCard member={member} />
            ))}
          </div>
        </div>
      )}

        {/* Event Team Section */}
        {eventTeam.length > 0 && (
            <div class="mb-12">
                <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white text-center sm:text-left">Event Team</h2>
                <div class="flex flex-wrap gap-6 justify-center sm:justify-start">
                    {eventTeam.map((member) => (
                        <StaffCard member={member} />
                    ))}
                </div>
            </div>
        )}

        {/* Tech Team Section */}
        {techTeam.length > 0 && (
            <div class="mb-12">
                <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white text-center sm:text-left">Tech Team</h2>
                <div class="flex flex-wrap gap-6 justify-center sm:justify-start">
                    {techTeam.map((member) => (
                        <StaffCard member={member} />
                    ))}
                </div>
            </div>
        )}
    </div>
</Layout>
